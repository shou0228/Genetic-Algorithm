# Genetic-Algorithm for APS #自動化生產線排程 #平行機台 

✒️排程目標: 
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
隨著工單逐漸多樣化、產量少且交期短，多機同步作業與換線需求大大增加了排程的難度，使得原本的排程規劃已無法有效提升生產效率，甚至

產生閒置，因此我們打算以用 GA 演算法作為 APS (先進規劃排程)的演算邏輯，以 Python 程式語言進行實作來解決此排程難題。

✒️生產線製程資訊與訂單資訊:
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
![image](https://user-images.githubusercontent.com/68886395/158193978-0402b276-8bfe-423b-9c65-15ba9304b01a.png)圖1 

![image](https://user-images.githubusercontent.com/68886395/158196237-71a49176-3093-4932-bbab-f3a46171610e.png)圖2

![image](https://user-images.githubusercontent.com/68886395/158204879-2d0fce92-8c37-4f38-82c0-6cb6fcc82f34.png)圖3

圖1高階顯卡種類三種，以 A、B、C 代表。各類顯卡工序相同（依序為自動鎖付風扇、人工鎖付背板、光學檢測步驟），但各工作站所需工作

時長不同並具有不同機種換線時間。

圖2訂單資訊包含多筆工單，模擬生產現場之商品種類多、交期不同、數量不同。

圖3可得自動螺絲機一台人工鎖付背板之作業員數量為兩人，光學檢測 AOI 機兩台，性能及工作時長相同。

✒️ 排程問題描述:
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
由於上述所提供生產線上製程相關資訊與訂單種類包含了換線時間、交期、工序與顯卡等諸多問題，我們為了讓此生產線達到生產時間最佳化

結合生產管理與作業研究相關知識，並結合個人的程式能力python語法以基因演算法撰寫此排程相關解決方式。

✒️ 程式導入前置:
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
>編碼原則:

![image](https://user-images.githubusercontent.com/68886395/158203159-c700fcb3-7e65-44f5-8325-04214134d3f6.png)

>生產線製程資訊轉換excel表(平行機台):

M0: 1台自動螺絲機、M1': 2位作業員 和 M2': 2台AOI機。各機台M數字部分為時間(分鐘)，Quantity 為各自工單的生產數量(個)

![image](https://user-images.githubusercontent.com/68886395/158203628-b995496e-0104-4e72-aff9-0763f71dc580.png)

✒️ 基因演算法程式說明:
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
a.初始設定:將讀檔後的資料及所需變數進行命名

![image](https://user-images.githubusercontent.com/68886395/158207172-2f2f9023-e779-4f31-98ef-2effae28b7fe.png)

“num_mc”為機器數，“num_job”為工件數，“pt”為處理時間的命名，“ct”為換線時間，主要是將資料內的位置以陣列方式去做讀取。

“typeSequence”主要為判斷工件 ABC 的種類。圖中 26-31 行為屆時程式可以自行輸入的觀察值、交配率、突變率、突變選擇率和所

需交配的次數等，也可選擇不輸入直接以本研究預設的默認值為準。

b.編碼:

編碼程序

![image](https://user-images.githubusercontent.com/68886395/158208361-cc726e95-33e4-49b7-8c91-f7ef77249038.png)

透過隨機的方式，產生初始序列的染色體。

![image](https://user-images.githubusercontent.com/68886395/158208411-14fb3725-e97d-4c46-9992-f8421d4bd714.png)

c.交配:

本研究藉由上一步驟產生的隨機序列染色體中，隨機抽取兩個兩個一組，根據初始設定的交配率來決定是否要進行交配，如果要交配

則藉由切割方式將兩組剛剛抽的染色體設為母代，並藉由切割染色體內基因線段的方式重新組成兩個子代。

![image](https://user-images.githubusercontent.com/68886395/158209023-3c7711cd-9d64-4a6e-893e-32e1519c503b.png)

![image](https://user-images.githubusercontent.com/68886395/158209048-d5e807aa-bac6-40e0-a831-835bcdd84809.png)

d.修復:

前一步驟所進行的交配，為隨機切割排列的方式。此會導致有些染色體內的基因(工件)出現次數過多或過少，如下圖所示，子代的5和3

會因此形成一個不可行的子代染色體排程解，此時本研究需將不可行的子代染色體進行修復動作，藉以得到可行解。

![image](https://user-images.githubusercontent.com/68886395/158209637-476e54e0-bb5b-4ffc-9567-a2fb229ce45a.png)

![image](https://user-images.githubusercontent.com/68886395/158209691-e8a94a38-a78d-4b44-83b2-2d9b06996166.png)

e.突變

依據先前突變選擇率(mutation selection rate)決定染色體中有多少百分比的基因要進行突變，假設每條染色體有 9 個基因，如下圖所示。

當 mutation selection rate 為 0.2 時，經由 9*0.2的計算並採四捨五入方式決定2個基因要進行突變。

![image](https://user-images.githubusercontent.com/68886395/158210506-10365c6d-5134-4067-980b-11909012b4a7.png)

![image](https://user-images.githubusercontent.com/68886395/158210538-edc1b6e1-20e2-4666-ae37-b72e14bd66be.png)

f.適應值計算

此問題目標為求出最短完工時間，故在適應值計算階段需寫出適合度函數的程式碼，用以計算適應值，即最短完工時間。

本階段程式碼分為 4 個部分，依序為「計算前設定」、「以機器做工件排序」、「排程邏輯」以及「適應值紀錄」。

(a) 計算前設定:

目的在於初始化適合度函數所需要的初始值以及串列儲存空間。其中下圖第 116 行的「total_chromsome」為儲存所有複

製的親代以及複製的子代染色體，用以被第 121 行的迴圈迭代，取出單一染色體用來被其他部分所計算。

(影像: image)![image](https://user-images.githubusercontent.com/68886395/158212494-4b3b18fc-4ffb-4b0a-96c1-42bb56d76d9a.png)






























